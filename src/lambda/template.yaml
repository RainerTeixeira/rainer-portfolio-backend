AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Blog API - Lambda + DynamoDB + Cognito (Free Tier)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PARÃ‚METROS GLOBAIS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Parameters:
  Environment:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - staging
      - prod
    Description: Ambiente de deployment (dev, staging ou prod)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# VARIÃVEIS GLOBAIS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Globals:
  Function:
    # âš¡ Lambda Free Tier: 1M requests + 400k GB-segundos/mÃªs GRÃTIS
    Timeout: 30 # MÃ¡ximo recomendado para API
    MemorySize: 512 # 512 MB = boa performance sem custo extra
    Runtime: nodejs20.x # Node.js 20 (mais recente)
    Architectures:
      - x86_64 # x86 tem Free Tier maior que ARM64
    Environment:
      Variables:
        NODE_ENV: !Ref Environment
        DATABASE_PROVIDER: DYNAMODB
        AWS_REGION: !Ref AWS::Region
        DYNAMODB_TABLE_PREFIX: !Sub ${AWS::StackName}-${Environment}
        LOG_LEVEL: !If
          - IsProduction
          - warn
          - debug
    Tracing: Active # X-Ray grÃ¡tis (1M traces/mÃªs)
    Tags:
      Environment: !Ref Environment
      Application: blog-backend-api
      ManagedBy: SAM
      CostCenter: FreeTier

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# RECURSOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Resources:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # FUNÃ‡ÃƒO LAMBDA - API PRINCIPAL
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BlogApiFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: es2020
        Sourcemap: true
        EntryPoints:
          - handler.ts
    Properties:
      FunctionName: !Sub ${AWS::StackName}-api-${Environment}
      Description: API principal do blog usando NestJS + Fastify
      Handler: dist/lambda/handler.lambdaHandler
      CodeUri: ../../

      # Function URL (alternativa gratuita ao API Gateway)
      FunctionUrlConfig:
        AuthType: NONE
        Cors:
          AllowOrigin: '*'
          AllowHeaders: Content-Type,Authorization,X-Requested-With
          AllowMethods: GET,POST,PUT,PATCH,DELETE,OPTIONS
          MaxAge: '86400'

      # PermissÃµes IAM
      Policies:
        - DynamoDBCrudPolicy:
            TableName: !Ref UsersTable
        - DynamoDBCrudPolicy:
            TableName: !Ref PostsTable
        - DynamoDBCrudPolicy:
            TableName: !Ref CategoriesTable
        - DynamoDBCrudPolicy:
            TableName: !Ref CommentsTable
        - DynamoDBCrudPolicy:
            TableName: !Ref LikesTable
        - DynamoDBCrudPolicy:
            TableName: !Ref BookmarksTable
        - DynamoDBCrudPolicy:
            TableName: !Ref NotificationsTable
        - Statement:
            - Effect: Allow
              Action:
                - logs:CreateLogGroup
                - logs:CreateLogStream
                - logs:PutLogEvents
              Resource: '*'

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # TABELAS DYNAMODB
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: USERS (â­ 5 RCU/WCU - Mais Acessada)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  UsersTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-users

      # ğŸ’° FREE TIER PERMANENTE: Provisioned (nÃ£o On-Demand!)
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 5 # â­ Mais acessado (auth)
        WriteCapacityUnits: 5

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: email
          AttributeType: S
        - AttributeName: username
          AttributeType: S
        - AttributeName: cognitoSub
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: EmailIndex
          KeySchema:
            - AttributeName: email
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

        - IndexName: UsernameIndex
          KeySchema:
            - AttributeName: username
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

        - IndexName: CognitoSubIndex
          KeySchema:
            - AttributeName: cognitoSub
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

      # Backup: grÃ¡tis atÃ© 10 GB (sempre habilitado)
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: false

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Users
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: POSTS (â­ 5 RCU/WCU - Mais Acessada)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PostsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-posts

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 5 # â­ Mais acessado (feed, listagens)
        WriteCapacityUnits: 5

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: slug
          AttributeType: S
        - AttributeName: authorId
          AttributeType: S
        - AttributeName: subcategoryId
          AttributeType: S
        - AttributeName: status
          AttributeType: S
        - AttributeName: createdAt
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: SlugIndex
          KeySchema:
            - AttributeName: slug
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

        - IndexName: AuthorIndex
          KeySchema:
            - AttributeName: authorId
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

        - IndexName: SubcategoryIndex
          KeySchema:
            - AttributeName: subcategoryId
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

        - IndexName: StatusIndex
          KeySchema:
            - AttributeName: status
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 5
            WriteCapacityUnits: 5

      # Backup: apenas produÃ§Ã£o
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: false

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Posts
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: CATEGORIES (3 RCU/WCU)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CategoriesTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-categories

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 3 # NavegaÃ§Ã£o frequente
        WriteCapacityUnits: 3

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: slug
          AttributeType: S
        - AttributeName: parentId
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: SlugIndex
          KeySchema:
            - AttributeName: slug
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

        - IndexName: ParentIdIndex
          KeySchema:
            - AttributeName: parentId
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: false

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Categories
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: COMMENTS (3 RCU/WCU)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CommentsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-comments

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 3 # InteraÃ§Ãµes mÃ©dias
        WriteCapacityUnits: 3

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: postId
          AttributeType: S
        - AttributeName: authorId
          AttributeType: S
        - AttributeName: createdAt
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: PostIndex
          KeySchema:
            - AttributeName: postId
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

        - IndexName: AuthorIndex
          KeySchema:
            - AttributeName: authorId
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: false

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Comments

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: LIKES (3 RCU/WCU)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LikesTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-likes

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 3 # Curtidas frequentes
        WriteCapacityUnits: 3

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: postId
          AttributeType: S
        - AttributeName: userId
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: PostIndex
          KeySchema:
            - AttributeName: postId
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

        - IndexName: UserIndex
          KeySchema:
            - AttributeName: userId
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Likes
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: BOOKMARKS (3 RCU/WCU)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BookmarksTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-bookmarks

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 3 # Salvamentos mÃ©dios
        WriteCapacityUnits: 3

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: postId
          AttributeType: S
        - AttributeName: userId
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH
      GlobalSecondaryIndexes:
        - IndexName: PostIndex
          KeySchema:
            - AttributeName: postId
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

        - IndexName: UserIndex
          KeySchema:
            - AttributeName: userId
              KeyType: HASH
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Bookmarks
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TABELA: NOTIFICATIONS (3 RCU/WCU)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  NotificationsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Sub ${AWS::StackName}-${Environment}-notifications

      # ğŸ’° FREE TIER PERMANENTE
      BillingMode: PROVISIONED
      ProvisionedThroughput:
        ReadCapacityUnits: 3 # NotificaÃ§Ãµes mÃ©dias
        WriteCapacityUnits: 3

      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: userId
          AttributeType: S
        - AttributeName: createdAt
          AttributeType: S

      KeySchema:
        - AttributeName: id
          KeyType: HASH

      GlobalSecondaryIndexes:
        - IndexName: UserIndex
          KeySchema:
            - AttributeName: userId
              KeyType: HASH
            - AttributeName: createdAt
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
          ProvisionedThroughput:
            ReadCapacityUnits: 3
            WriteCapacityUnits: 3

      Tags:
        - Key: Environment
          Value: !Ref Environment
        - Key: Resource
          Value: Notifications
        - Key: CostOptimization
          Value: FreeTierProvisioned

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # LOGS
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BlogApiLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub /aws/lambda/${BlogApiFunction}
      RetentionInDays: 7

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OUTPUTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Outputs:
  # API
  BlogApiFunctionUrl:
    Description: URL da Function URL (endpoint HTTP da API)
    Value: !GetAtt BlogApiFunctionUrl.FunctionUrl
    Export:
      Name: !Sub ${AWS::StackName}-api-url

  BlogApiFunctionArn:
    Description: ARN da funÃ§Ã£o Lambda
    Value: !GetAtt BlogApiFunction.Arn
    Export:
      Name: !Sub ${AWS::StackName}-api-arn

  # Tabelas DynamoDB
  UsersTableName:
    Description: Nome da tabela de usuÃ¡rios
    Value: !Ref UsersTable
    Export:
      Name: !Sub ${AWS::StackName}-users-table

  PostsTableName:
    Description: Nome da tabela de posts
    Value: !Ref PostsTable
    Export:
      Name: !Sub ${AWS::StackName}-posts-table

  CategoriesTableName:
    Description: Nome da tabela de categorias
    Value: !Ref CategoriesTable
    Export:
      Name: !Sub ${AWS::StackName}-categories-table

  CommentsTableName:
    Description: Nome da tabela de comentÃ¡rios
    Value: !Ref CommentsTable
    Export:
      Name: !Sub ${AWS::StackName}-comments-table

  LikesTableName:
    Description: Nome da tabela de likes
    Value: !Ref LikesTable
    Export:
      Name: !Sub ${AWS::StackName}-likes-table

  BookmarksTableName:
    Description: Nome da tabela de bookmarks
    Value: !Ref BookmarksTable
    Export:
      Name: !Sub ${AWS::StackName}-bookmarks-table

  NotificationsTableName:
    Description: Nome da tabela de notificaÃ§Ãµes
    Value: !Ref NotificationsTable
    Export:
      Name: !Sub ${AWS::StackName}-notifications-table

  # InformaÃ§Ãµes de deployment
  StackName:
    Description: Nome da stack CloudFormation
    Value: !Ref AWS::StackName

  Region:
    Description: RegiÃ£o AWS onde a stack foi deployada
    Value: !Ref AWS::Region

  # ğŸ’° Resumo de Custos (FREE TIER PERMANENTE)
  FreeTierSummary:
    Description: Resumo do Free Tier AWS (Custo ZERO Permanente)
    Value: !Sub |
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ’° FREE TIER PERMANENTE - CUSTO R$ 0,00 PARA SEMPRE!
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      ğŸ“Š DynamoDB Provisioned (7 tabelas):
         â­ Users: 5 RCU + 5 WCU (autenticaÃ§Ã£o)
         â­ Posts: 5 RCU + 5 WCU (feed principal)
         ğŸ“„ Categories: 3 RCU + 3 WCU (navegaÃ§Ã£o)
         ğŸ’¬ Comments: 3 RCU + 3 WCU (interaÃ§Ãµes)
         â¤ï¸  Likes: 3 RCU + 3 WCU (curtidas)
         ğŸ”– Bookmarks: 3 RCU + 3 WCU (salvamentos)
         ğŸ”” Notifications: 3 RCU + 3 WCU (notificaÃ§Ãµes)
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         TOTAL: 25 RCU + 25 WCU = GRÃTIS SEMPRE! âœ…

      âš¡ Lambda:
         â€¢ 1 milhÃ£o de requests/mÃªs = GRÃTIS
         â€¢ 400k GB-segundos compute = GRÃTIS
         â€¢ Runtime: Node.js 20.x (x86_64)

      ğŸ” Cognito User Pool:
         â€¢ 50.000 MAU (usuÃ¡rios ativos) = GRÃTIS

      ğŸ“ CloudWatch Logs:
         â€¢ 5 GB ingest/mÃªs = GRÃTIS
         â€¢ RetenÃ§Ã£o: 7 dias (dev), 30 dias (prod)

      ğŸŒ Lambda Function URL:
         â€¢ 100% GRÃTIS (sem API Gateway)

      ğŸ›¡ï¸ Para NÃƒO Ultrapassar Free Tier:
         1. Use CloudFront/cache (reduz leituras)
         2. Itens â‰¤ 1 KB (escrita), â‰¤ 4 KB (leitura)
         3. MÃ­dia no S3, metadados no DynamoDB
         4. Configure CloudWatch Alarms

      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Environment:
    Description: Ambiente de deployment
    Value: !Ref Environment