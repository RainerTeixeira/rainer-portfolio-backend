
> @rainersoft/portfolio-backend@4.1.1 test C:\Desenvolvimento\rainer-portfolio-backend
> jest

PASS src/modules/dashboard/services/dashboard.service.spec.ts (14.106 s)
  DashboardService
    ÔêÜ should be defined (43 ms)
    getStats
      ÔêÜ should return dashboard statistics with default values (10 ms)
      ÔêÜ should return a Promise that resolves to DashboardStats (5 ms)
    getAnalytics
      ÔêÜ should return analytics data with empty arrays (5 ms)
      ÔêÜ should return a Promise that resolves to analytics structure (14 ms)

PASS src/modules/users/services/users.service.spec.ts (14.203 s)
  UsersService
    ÔêÜ should be defined (55 ms)
    createUser
      ÔêÜ should create a new user (9 ms)
    findByEmail
      ÔêÜ should return user when found by email (5 ms)
      ÔêÜ should return null when user not found by email (4 ms)
    isNameTaken
      ÔêÜ should return true when name is already taken (6 ms)
      ÔêÜ should return false when name is available (6 ms)
    getUserById
      ÔêÜ should return user when found by id (13 ms)
      ÔêÜ should return null when user not found by id (5 ms)
    updateUser
      ÔêÜ should update user successfully (5 ms)
      ÔêÜ should throw error when user not found (29 ms)

[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error decoding JWT:
[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error: Invalid token format
    at AuthService.decodeJWT (C:\Desenvolvimento\rainer-portfolio-backend\src\auth\auth.service.ts:217:15)
    at Object.<anonymous> (C:\Desenvolvimento\rainer-portfolio-backend\src\auth\auth.service.spec.ts:53:39)
    at Promise.then.completed (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error decoding JWT:
[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error: Invalid token format
    at AuthService.decodeJWT (C:\Desenvolvimento\rainer-portfolio-backend\src\auth\auth.service.ts:217:15)
    at Object.<anonymous> (C:\Desenvolvimento\rainer-portfolio-backend\src\auth\auth.service.spec.ts:61:39)
    at Promise.then.completed (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error syncing user with database:
[Nest] 23992  - 15/12/2025, 11:59:42   ERROR [AuthService] Error: Database error
    at Object.<anonymous> (C:\Desenvolvimento\rainer-portfolio-backend\src\auth\auth.service.spec.ts:112:62)
    at Promise.then.completed (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\Desenvolvimento\rainer-portfolio-backend\node_modules\jest-runner\build\testWorker.js:106:12)
PASS src/modules/health/health.service.spec.ts
  HealthService
    ÔêÜ should be defined (17 ms)
    getBasicHealth
      ÔêÜ should return basic health status (7 ms)
      ÔêÜ should return a valid ISO timestamp (5 ms)
    getDetailedHealth
      ÔêÜ should return detailed health status with memory info (10 ms)
      ÔêÜ should return valid memory usage data (13 ms)
      ÔêÜ should return database provider info (3 ms)

PASS src/auth/auth.service.spec.ts (14.835 s)
  AuthService
    ÔêÜ should be defined (83 ms)
    decodeJWT
      ÔêÜ should decode valid JWT token (8 ms)
      ÔêÜ should return empty object for invalid token (106 ms)
      ÔêÜ should handle malformed JWT token (9 ms)
    syncUserWithDatabase
      ÔêÜ should create new user if not exists (8 ms)
      ÔêÜ should not create user if already exists (6 ms)
      ÔêÜ should handle errors gracefully without throwing (9 ms)

PASS src/modules/categories/services/categories.service.spec.ts
  CategoriesService
    ÔêÜ should be defined (13 ms)
    createCategory
      ÔêÜ should create a new category (6 ms)
      ÔêÜ should create category with default isActive true (6 ms)
    getCategoryById
      ÔêÜ should return category by id (15 ms)
      ÔêÜ should return null when category not found (3 ms)
    getCategoryBySlug
      ÔêÜ should return category by slug (3 ms)
      ÔêÜ should return null when slug not found (3 ms)
    getAllCategories
      ÔêÜ should return all categories (4 ms)
    updateCategory
      ÔêÜ should update category (4 ms)
    deleteCategory
      ÔêÜ should delete category (3 ms)

PASS src/modules/likes/services/likes.service.spec.ts (14.91 s)
  LikesService
    ÔêÜ should be defined (63 ms)
    likePost
      ÔêÜ should create a new like for post (11 ms)
      ÔêÜ should return existing like if already liked (5 ms)
    likeComment
      ÔêÜ should create a new like for comment (6 ms)
      ÔêÜ should return existing like if already liked (7 ms)
    unlikePost
      ÔêÜ should delete like by user and post (4 ms)
    unlikeComment
      ÔêÜ should delete like by user and comment (8 ms)
    getLikeById
      ÔêÜ should return like by id (5 ms)
    getPostLikes
      ÔêÜ should return all likes for a post (6 ms)
    getCommentLikes
      ÔêÜ should return all likes for a comment (6 ms)
    getUserLikes
      ÔêÜ should return all likes by user (4 ms)
    isPostLikedByUser
      ÔêÜ should return true when post is liked (3 ms)
      ÔêÜ should return false when post is not liked (4 ms)
    isCommentLikedByUser
      ÔêÜ should return true when comment is liked (5 ms)
      ÔêÜ should return false when comment is not liked (10 ms)

PASS src/modules/notifications/services/notifications.service.spec.ts (15.186 s)
  NotificationsService
    ÔêÜ should be defined (45 ms)
    createNotification
      ÔêÜ should create a new notification (10 ms)
      ÔêÜ should create notification with default isRead false (15 ms)
    getNotificationById
      ÔêÜ should return notification by id (7 ms)
      ÔêÜ should return null when notification not found (13 ms)
    getUserNotifications
      ÔêÜ should return user notifications with options (4 ms)
      ÔêÜ should return user notifications without options (4 ms)
    markAsRead
      ÔêÜ should mark notification as read (7 ms)
    markAllAsRead
      ÔêÜ should mark all user notifications as read (6 ms)
    deleteNotification
      ÔêÜ should delete notification (7 ms)
    deleteAllNotifications
      ÔêÜ should delete all user notifications (5 ms)
    getUnreadCount
      ÔêÜ should return unread count for user (3 ms)
    notifyNewLike
      ÔêÜ should create notification for new like (4 ms)
    notifyNewComment
      ÔêÜ should create notification for new comment (5 ms)
    notifyNewFollower
      ÔêÜ should create notification for new follower (4 ms)

PASS src/modules/bookmarks/services/bookmarks.service.spec.ts (15.236 s)
  BookmarksService
    ÔêÜ should be defined (53 ms)
    bookmarkPost
      ÔêÜ should create a new bookmark for post (29 ms)
      ÔêÜ should return existing bookmark if already bookmarked (6 ms)
    bookmarkComment
      ÔêÜ should create a new bookmark for comment (5 ms)
      ÔêÜ should return existing bookmark if already bookmarked (6 ms)
    unbookmarkPost
      ÔêÜ should delete bookmark by user and post (9 ms)
    unbookmarkComment
      ÔêÜ should delete bookmark by user and comment (5 ms)
    getBookmarkById
      ÔêÜ should return bookmark by id (3 ms)
    getPostBookmarks
      ÔêÜ should return all bookmarks for a post (4 ms)
    getCommentBookmarks
      ÔêÜ should return all bookmarks for a comment (4 ms)
    getUserBookmarks
      ÔêÜ should return user bookmarks with options (6 ms)
      ÔêÜ should return user bookmarks without options (4 ms)
    isPostBookmarkedByUser
      ÔêÜ should return true when post is bookmarked (3 ms)
      ÔêÜ should return false when post is not bookmarked (3 ms)
    isCommentBookmarkedByUser
      ÔêÜ should return true when comment is bookmarked (2 ms)
      ÔêÜ should return false when comment is not bookmarked (2 ms)

FAIL src/modules/posts/services/posts.service.spec.ts
  ÔùÅ Test suite failed to run

    src/modules/posts/services/posts.service.spec.ts:65:47 - error TS2345: Argument of type '{ title: string; slug: string; content: string; excerpt: string; coverImage: string; authorId: string; categoryId: string; status: string; publishedAt: Date; tags: string[]; readTime: number; isFeatured: boolean; }' is not assignable to parameter of type 'CreatePostDto'.
      Types of property 'status' are incompatible.
        Type 'string' is not assignable to type '"DRAFT" | "PUBLISHED" | "ARCHIVED" | undefined'.

    65       const result = await service.createPost(dto);
                                                     ~~~
    src/modules/posts/services/posts.service.spec.ts:104:47 - error TS2345: Argument of type '{ title: string; slug: string; content: string; authorId: string; }' is not assignable to parameter of type 'CreatePostDto'.
      Property 'categoryId' is missing in type '{ title: string; slug: string; content: string; authorId: string; }' but required in type 'CreatePostDto'.

    104       const result = await service.createPost(dto);
                                                      ~~~

      src/modules/posts/dto/create-post.dto.ts:8:3
        8   categoryId: string;
            ~~~~~~~~~~
        'categoryId' is declared here.

FAIL src/modules/comments/services/comments.service.spec.ts
  ÔùÅ Test suite failed to run

    src/modules/comments/services/comments.service.spec.ts:61:50 - error TS2345: Argument of type '{ content: string; authorId: string; postId: string; parentId: string; status: string; }' is not assignable to parameter of type 'CreateCommentDto'.
      Types of property 'status' are incompatible.
        Type 'string' is not assignable to type '"PENDING" | "APPROVED" | "REJECTED" | undefined'.

    61       const result = await service.createComment(dto);
                                                        ~~~

Test Suites: 2 failed, 8 passed, 10 total
Tests:       84 passed, 84 total
Snapshots:   0 total
Time:        19.752 s
Ran all test suites.
ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.
